apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: kured
  namespace: kube-system
spec:
  chart:
    spec:
      chart: kured
      reconcileStrategy: ChartVersion
      sourceRef:
        kind: HelmRepository
        name: kubereboot
      version: "5.4.3"
  interval: 1m0s
  releaseName: kured
  targetNamespace: kube-system
  valuesFrom:
    - kind: Secret
      name: kured-values
---
apiVersion: monitoring.coreos.com/v1
kind: PodMonitor
metadata:
  name: kured-pod-monitor
  namespace: kube-system
  labels:
    release: kube-prometheus-stack
spec:
  selector:
    matchLabels:
      app.kubernetes.io/instance: kured
  podMetricsEndpoints:
  - port: metrics
    path: '/metrics'
  namespaceSelector:
    matchNames:
    - kube-system
